package view.vulnerabilities_tab;

import burp.IBurpExtenderCallbacks;
import burp.IExtensionHelpers;
import burp.IParameter;
import com.google.gson.JsonSyntaxException;
import com.jgoodies.forms.layout.CellConstraints;
import com.jgoodies.forms.layout.FormLayout;
import models.asset.Asset;
import models.auto_filter_combobox.AutoFilterAssetsComboboxModel;
import models.auto_filter_combobox.AutoFilterComboboxModel;
import models.attachments.AttachmentFileChooser;
import models.project.Project;
import models.services_manager.ServicesManager;
import models.tabs_manager.TabsManager;
import models.attachments.AttachmentArchive;
import models.vulnerability.graphql.mutations.responses.CreatedVulnerabilityQL;
import models.vulnerability.template.Template;
import models.vulnerability.Vulnerability;
import org.apache.http.auth.AuthenticationException;
import org.apache.http.client.HttpResponseException;
import org.commonmark.node.Node;
import org.commonmark.parser.Parser;
import org.commonmark.renderer.html.HtmlRenderer;
import services.TemplateService;
import services.VulnerabilitiesService;
import services.AssetService;
import view.FathersComponentTab;
import view.vulnerabilities_tab.info_template.ShowTemplateInformation;
import view.vulnerabilities_tab.popup_menu.AttachmentPopupMenu;
import view.vulnerabilities_tab.listeners.AutoFilterAssetsComboboxListener;
import view.vulnerabilities_tab.listeners.AutoFilterComboboxListener;
import view.vulnerabilities_tab.listeners.RefreshTemplatesButtonListener;

import javax.swing.*;
import javax.swing.border.TitledBorder;
import javax.swing.event.ChangeListener;
import javax.swing.plaf.FontUIResource;
import javax.swing.text.StyleContext;
import java.awt.*;
import java.awt.datatransfer.Clipboard;
import java.awt.datatransfer.StringSelection;
import java.awt.event.*;
import java.net.URI;
import java.nio.charset.StandardCharsets;
import java.util.*;
import java.util.List;
import java.util.stream.Collectors;

public class NewVulnerabilityTab extends FathersComponentTab {
    private JComboBox cbVulnerabilityTemplates;
    private JRadioButton probabilityLowRButton;
    private JRadioButton probabilityMediumRButton;
    private JRadioButton probabilityHighRButton;
    private JRadioButton impactLowRButton;
    private JRadioButton impactMediumRButton;
    private JRadioButton impactHighRButton;
    private JEditorPane txtAreaDescription;
    private JButton btnRefreshVT;
    private JTextField txtFieldProjectId;
    private JComboBox<Asset> cbAssets;
    private JButton btnLoadAssets;
    private JTextField txtFieldMethod;
    private JTextField txtFieldProtocol;
    private JTextField txtFieldUrl;
    private JTextArea txtAreaRequest;
    private JTextArea txtAreaResponse;
    private JList listParameters;
    private JButton btnRemoveParameter;
    private JButton btnRemoveAllParameters;
    private JButton btnRedactValue;
    private JScrollPane rootPanel;
    private JPanel rootPanel2;

    private TemplateService templateService;
    private VulnerabilitiesService vulnerabilitiesService;
    private AssetService assetService;
    DefaultListModel<String> parametersListModel;
    private DefaultListModel<AttachmentArchive> evidenceListModel;
    private JEditorPane txtAreaStepsToReproduce;
    private JButton btnSubmitForm;
    private JButton btnClearForm;
    private JEditorPane txtAreaImpact;
    private JRadioButton noCompromisedEnvironmentRButton;
    private JRadioButton yesCompromisedEnvironmentRButton;
    private JTabbedPane tabParametersRequestResponse;
    private JTabbedPane tabDescriptionImpactSteps;
    private JTextArea txtAreaCompromisedEnvironment;
    private JScrollPane scrollPaneCompromisedEnvironment;
    private JLabel lblImpact;
    private JLabel lblProbability;
    private JLabel lblProjectId;
    private JLabel lblAssetId;
    private JLabel lblMethod;
    private JLabel lblProtocol;
    private JLabel lblUrl;
    private JLabel lblVulnerabilityTemplate;
    private JLabel lblCompromisedEnvironment;
    private JList listEvidence;
    private JButton btnPreviewDescription;
    private JButton btnPreviewStepsToReproduce;
    private JLabel lblViewTemplate;
    private JButton btnImportParametersFromRequest;
    private JLabel lblCopyUri;
    private JButton btnPreviewImpact;
    private JButton btnHelp;
    private JButton btnAddAttachment;
    private JLabel lblAttachmentHint;
    private static final String CONVISO_PROJECT_ID = "CONVISO.PROJECT.ID";
    private String evidencePlaceholder = "No attachments yet. Click Add attachment or right click to add.";
    private AutoFilterComboboxModel autoFilterComboboxModel;
    private AutoFilterAssetsComboboxModel assetsComboboxModel;
    private boolean fromContextMenu;
    private int qtdEvidence = 0;
    boolean previewMarkdownDescription, previewMarkdownStepsToReproduce, previewMarkdownImpact;
    HashMap<String, String> beforePreviewContents;
    Parser parser = Parser.builder().build();
    HtmlRenderer renderer = HtmlRenderer.builder().build();

    String defaultTabTitle = "<html>%s</html>";
    String defaultSelectedTabTitle = "<html><b>%s</b></html>";

    String defaultRequiredSelectedTabTitle = "<html><b><p style=\"color:red\">%s*</p></b></html>";
    String defaultRequiredTabTitle = "<html><p style=\"color:red\">%s*</p></html>";

    String defaultRequiredSelectedTabTitleDarkBackground = "<html><b><p style=\"color:orange\">%s*</p></b></html>";
    String defaultRequiredTabTitleDarkBackground = "<html><p style=\"color:orange\">%s*</p></html>";


    public NewVulnerabilityTab(final IBurpExtenderCallbacks callbacks, final IExtensionHelpers helpers, ServicesManager servicesManager, TabsManager tabsManager) {
        super(callbacks, helpers, servicesManager, tabsManager);
        this.assetService = super.servicesManager.getAssetService();
        this.templateService = super.servicesManager.getTemplateService();
        this.vulnerabilitiesService = super.servicesManager.getVulnerabilityService();
        this.parametersListModel = new DefaultListModel<String>();
        this.evidenceListModel = new DefaultListModel<AttachmentArchive>();
        this.fromContextMenu = false;
        this.previewMarkdownDescription = false;
        this.previewMarkdownStepsToReproduce = false;
        this.beforePreviewContents = new HashMap<>();
    }

    public void initializeComponent() {
        // GUI initializer generated by IntelliJ IDEA GUI Designer
        // >>> IMPORTANT!! <<<
        // DO NOT EDIT OR ADD ANY CODE HERE!
        $$$setupUI$$$();

        this.setRootPanel(rootPanel2);
        this.setDefaultColors(lblVulnerabilityTemplate);
        txtFieldProjectId.setVisible(false);
        refreshProjectHeaderAsync();
        this.disableViewTemplate();
        applyTooltips();

        if (this.isDarkBackground) {
            lblCopyUri.setIcon(new ImageIcon(getClass().getResource("/icons/copy-darkbkg.png")));
        } else {
            lblCopyUri.setIcon(new ImageIcon(getClass().getResource("/icons/copy-lightbkg.png")));
        }

        lblCopyUri.addPropertyChangeListener(evt -> {
            if (evt.getPropertyName().equals("foreground")) {
                if (this.isDarkBackground) {
                    lblCopyUri.setIcon(new ImageIcon(getClass().getResource("/icons/copy-darkbkg.png")));
                } else {
                    lblCopyUri.setIcon(new ImageIcon(getClass().getResource("/icons/copy-lightbkg.png")));
                }
            }
        });


        super.addLblBoldListener(lblVulnerabilityTemplate);
        super.addLblBoldListener(lblProjectId);
        super.addLblBoldListener(lblAssetId);
        super.addLblBoldListener(lblMethod);
        super.addLblBoldListener(lblProtocol);
        super.addLblBoldListener(lblImpact);
        super.addLblBoldListener(lblUrl);
        super.addLblBoldListener(lblProbability);
        super.addLblBoldListener(lblCompromisedEnvironment);

        this.listParameters.setModel(parametersListModel);
        this.lblViewTemplate.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
        this.lblViewTemplate.setEnabled(false);
        this.lblViewTemplate.setVisible(false);

        autoFilterComboboxModel = new AutoFilterComboboxModel();
        cbVulnerabilityTemplates.setModel(autoFilterComboboxModel);
        cbVulnerabilityTemplates.putClientProperty("JComboBox.isTableCellEditor", Boolean.TRUE);

        assetsComboboxModel = new AutoFilterAssetsComboboxModel();
        cbAssets.setModel(assetsComboboxModel);
        cbAssets.setEditable(true);
        cbAssets.putClientProperty("JComboBox.isTableCellEditor", Boolean.TRUE);

        this.setBoldTitleTab(tabDescriptionImpactSteps);
        this.setBoldTitleTab(tabParametersRequestResponse);

        this.listEvidence.setModel(this.evidenceListModel);

        evidenceListModel.addElement(new AttachmentArchive(evidencePlaceholder, evidencePlaceholder));

        AutoFilterComboboxListener autoFilterComboboxListener = new AutoFilterComboboxListener(this.callbacks, this.helpers, cbVulnerabilityTemplates);

        JTextField textEditor = (JTextField) cbVulnerabilityTemplates.getEditor().getEditorComponent();
        textEditor.addKeyListener(autoFilterComboboxListener);

        AutoFilterAssetsComboboxListener autoFilterAssetsListener = new AutoFilterAssetsComboboxListener(this.callbacks, this.helpers, cbAssets);
        JTextField assetEditor = (JTextField) cbAssets.getEditor().getEditorComponent();
        assetEditor.addKeyListener(autoFilterAssetsListener);

        cbVulnerabilityTemplates.addActionListener(e -> {
            switch (e.getActionCommand()) {
                case "comboBoxChanged":
                    try {
                        Template templatePicked = (Template) autoFilterComboboxModel.getSelectedItem();
                        if (templatePicked != null) {
                            this.enableViewTemplate();
                        } else {
                            this.disableViewTemplate();
                        }
                        if (templatePicked != null && !templatePicked.getNotification()) {
                            this.notificationTemplateSelected(false);
                            switch (templatePicked.getProbability()) {
                                case "high":
                                    probabilityHighRButton.setSelected(true);
                                    break;
                                case "medium":
                                    probabilityMediumRButton.setSelected(true);
                                    break;
                                case "low":
                                    probabilityLowRButton.setSelected(true);
                                    break;
                                default:
                                    break;
                            }
                            switch (templatePicked.getImpact()) {
                                case "high":
                                    impactHighRButton.setSelected(true);
                                    break;
                                case "medium":
                                    impactMediumRButton.setSelected(true);
                                    break;
                                case "low":
                                    impactLowRButton.setSelected(true);
                                    break;
                                default:
                                    break;
                            }
                            cbVulnerabilityTemplates.requestFocus();
                        } else if (templatePicked != null && templatePicked.getNotification()) {
                            this.notificationTemplateSelected(true);
                        }
                    } catch (ClassCastException | NullPointerException ignored) {
                        this.disableViewTemplate();
                    }
                    break;
                case "comboBoxEdited":
                    break;

            }
        });

        ChangeListener tabbChangeListener = e -> {
            if (e.getSource() instanceof JTabbedPane) {
                JTabbedPane tabbedPane = (JTabbedPane) e.getSource();
                setBoldTitleTab(tabbedPane);
            }
        };

        tabParametersRequestResponse.addChangeListener(tabbChangeListener);
        tabDescriptionImpactSteps.addChangeListener(tabbChangeListener);


        lblCopyUri.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                StringSelection selection = new StringSelection(txtFieldUrl.getText());
                Clipboard clipboard = Toolkit.getDefaultToolkit().getSystemClipboard();
                clipboard.setContents(selection, selection);
                JOptionPane.showMessageDialog(rootPanel2, "Copied to clipboard!");
            }
        });

        final RefreshTemplatesButtonListener rtb = new RefreshTemplatesButtonListener(this.callbacks, this.helpers, cbVulnerabilityTemplates, this.templateService);
        btnRefreshVT.addActionListener(e -> new Thread(() -> rtb.mouseClicked(e)).start());

        btnLoadAssets.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                if (!btnLoadAssets.isEnabled()) {
                    return;
                }
                btnLoadAssets.setEnabled(false);
                new Thread(() -> {
                    Integer projectId = getProjectId();
                    if (projectId == null) {
                        JOptionPane.showMessageDialog(rootPanel2, "Please select a project in Settings.");
                        btnLoadAssets.setEnabled(true);
                        return;
                    }
                    try {
                        Set<Asset> assets = assetService.getAssetsByProjectId(projectId);
                        SwingUtilities.invokeLater(() -> {
                            assetsComboboxModel.setAssetsList(new ArrayList<>(assets));
                            clearAssetSelection();
                            if (assets.isEmpty()) {
                                JOptionPane.showMessageDialog(rootPanel2, "No assets returned by API.");
                            } else {
                                JOptionPane.showMessageDialog(rootPanel2, "Loaded " + assets.size() + " assets.");
                            }
                            btnLoadAssets.setEnabled(true);
                        });
                    } catch (AuthenticationException ex) {
                        JOptionPane.showMessageDialog(rootPanel2, "Authentication not OK!\nPlease check API KEY!");
                        btnLoadAssets.setEnabled(true);
                    }
                }).start();
            }
        });

        lblViewTemplate.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                if (lblViewTemplate.isEnabled() && lblViewTemplate.isVisible()) {
                    showInfoTemplateSelected();
                }
            }
        });

        MouseAdapter rdButtonlistener = new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                requestFocusNextFieldRadioButtons();
            }
        };
        probabilityLowRButton.addMouseListener(rdButtonlistener);
        probabilityMediumRButton.addMouseListener(rdButtonlistener);
        probabilityHighRButton.addMouseListener(rdButtonlistener);
        impactLowRButton.addMouseListener(rdButtonlistener);
        impactMediumRButton.addMouseListener(rdButtonlistener);
        impactHighRButton.addMouseListener(rdButtonlistener);

        btnRemoveParameter.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {

                List<Integer> indexes = Arrays.stream(listParameters.getSelectedIndices()).boxed().collect(Collectors.toList());
                Collections.reverse(indexes);

                for (int index :
                        indexes) {
                    parametersListModel.remove(index);
                }
            }
        });

        listEvidence.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                if (SwingUtilities.isRightMouseButton(e) || (SwingUtilities.isLeftMouseButton(e) && e.getClickCount() == 2)) {
                    AttachmentPopupMenu evidencePopupMenu = new AttachmentPopupMenu(NewVulnerabilityTab.this);
                    evidencePopupMenu.show((Component) e.getSource(), e.getX(), e.getY());
                }
            }
        });

        btnRemoveAllParameters.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                new Thread(() -> parametersListModel.clear()).start();
            }
        });

        btnRedactValue.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                new Thread(() -> {
                    int[] values = listParameters.getSelectedIndices();
                    for (int val :
                            values) {
                        String textContent = (String) listParameters.getModel().getElementAt(val);
                        parametersListModel.set(val, textContent.substring(0, textContent.indexOf("=")) + "=**REDACTED**");
                    }

                }).start();
            }
        });

        btnSubmitForm.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                try {
                    Template templatePicked = (Template) autoFilterComboboxModel.getSelectedItem();
                    Vulnerability vulnerability;
                    if (templatePicked.getNotification()) {
                        vulnerability = validateNotification();
                    } else {
                        vulnerability = validateVulnerability();
                    }

                    if (vulnerability != null) {
                        new Thread(() -> {
                            btnSubmitForm.setEnabled(false);
                            try {
                                CreatedVulnerabilityQL createdVulnerabilityQL;
                                if (vulnerability.isNotification()) {
                                    createdVulnerabilityQL = vulnerabilitiesService.postNotification(vulnerability);
                                } else {
                                    createdVulnerabilityQL = vulnerabilitiesService.postVulnerability(vulnerability);
                                }

                                if (createdVulnerabilityQL.getErrors().length == 0) {
                                    JOptionPane.showMessageDialog(NewVulnerabilityTab.this.getRootPanel2(), "Created!");
                                    clearForm();
                                } else {
                                    String joinedErrors = createdVulnerabilityQL.getJoinedErrors();
                                    util.sendStderr(joinedErrors);
                                    JOptionPane.showMessageDialog(NewVulnerabilityTab.this.getRootPanel2(), "Error!\n" + joinedErrors);
                                }
                            } catch (HttpResponseException | NullPointerException httpResponseException) {
                                JOptionPane.showMessageDialog(NewVulnerabilityTab.this.getRootPanel2(), "Something went wrong!\nCheck errors on extender tab!");
                            } catch (AuthenticationException authenticationException) {
                                JOptionPane.showMessageDialog(NewVulnerabilityTab.this.getRootPanel2(), "Authentication not OK!\nPlease check API KEY!");
                            } catch (Error | JsonSyntaxException err) {
                                util.sendStderr(err.toString());
                                err.printStackTrace();
                                String message = err.getMessage();
                                if (message == null || message.trim().isEmpty()) {
                                    message = err.toString();
                                }
                                JOptionPane.showMessageDialog(NewVulnerabilityTab.this.getRootPanel2(), "Something went wrong!\n" + message);
                            }
                            btnSubmitForm.setEnabled(true);
                        }).start();
                    }
                } catch (NullPointerException | ClassCastException ignored) {
                    getDefinedTemplateId();
                    JOptionPane.showMessageDialog(getRootPanel2(), "Template not defined!");
                }
            }
        });

        btnClearForm.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                clearForm();
            }
        });

        btnPreviewStepsToReproduce.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                togglePreviewStepsToReproduce();
            }
        });

        btnPreviewImpact.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                togglePreviewImpact();
            }
        });

        btnPreviewDescription.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                togglePreviewDescription();
            }
        });

        btnHelp.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                showHelpDialog();
            }
        });

        btnAddAttachment.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                AttachmentPopupMenu evidencePopupMenu = new AttachmentPopupMenu(NewVulnerabilityTab.this);
                evidencePopupMenu.show(btnAddAttachment, 0, btnAddAttachment.getHeight());
            }
        });

        btnImportParametersFromRequest.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                if (!txtAreaRequest.getText().isEmpty()) {
                    List<IParameter> parameters = helpers.analyzeRequest(txtAreaRequest.getText().getBytes(StandardCharsets.UTF_8)).getParameters();
                    if (!parameters.isEmpty()) setListParameters(parameters);
                    else JOptionPane.showMessageDialog(getRootPanel2(), "This request has no parameters.");
                } else {
                    tabParametersRequestResponse.setSelectedIndex(1);
                    txtAreaRequest.requestFocus();
                    JOptionPane.showMessageDialog(getRootPanel2(), "Please define request!");
                }

            }
        });

        yesCompromisedEnvironmentRButton.addMouseListener(new MouseAdapter() {
            @Override
            public void mousePressed(MouseEvent e) {
                new Thread(() -> {
                    noCompromisedEnvironmentRButton.setEnabled(false);
                    scrollPaneCompromisedEnvironment.setVisible(true);
                    txtAreaCompromisedEnvironment.setVisible(true);
                    txtAreaCompromisedEnvironment.requestFocus();
                    noCompromisedEnvironmentRButton.setEnabled(true);
                }).start();

            }
        });

        noCompromisedEnvironmentRButton.addMouseListener(new MouseAdapter() {
            @Override
            public void mousePressed(MouseEvent e) {
                new Thread(() -> {
                    yesCompromisedEnvironmentRButton.setEnabled(false);
                    scrollPaneCompromisedEnvironment.setVisible(false);
                    txtAreaCompromisedEnvironment.setVisible(false);
                    requestFocusNextFieldRadioButtons();
                    yesCompromisedEnvironmentRButton.setEnabled(true);
                }).start();
            }
        });




    }

    private void previewMarkDownText(boolean markDownBooleanVariable, String markDownHashmapKey, JEditorPane txtArea) {
        if (markDownBooleanVariable) {
            String text = txtArea.getText();
            beforePreviewContents.put(markDownHashmapKey, text);
            Node document = parser.parse(text.replaceAll("<", "&lt;").replaceAll(">", "&gt;"));
            txtArea.setContentType("text/html");
            txtArea.setText(renderer.render(document).replaceAll("\\r?\\n", "<br/>").replaceFirst("<p>", "<p style=\"margin-top: 0\">"));
            txtArea.setEnabled(false);
        } else {
            txtArea.setContentType("text/plain");
            txtArea.setText(beforePreviewContents.get(markDownHashmapKey));
            txtArea.setEnabled(true);

        }
    }

    public void requestFocusNextFieldRadioButtons() {

        int selectedTab = tabDescriptionImpactSteps.getSelectedIndex();

        switch (selectedTab) {
            case 0:
                txtAreaDescription.requestFocus();
                break;
            case 1:
                txtAreaImpact.requestFocus();
                break;
            case 2:
                txtAreaStepsToReproduce.requestFocus();
                break;
            default:
                txtFieldMethod.requestFocus();
                break;
        }
    }

    public void clearForm() {
        this.fromContextMenu = false;

        txtAreaDescription.setText("");
        if (!txtAreaDescription.isEnabled()) {
            txtAreaDescription.setEnabled(true);
            if (txtAreaDescription.getContentType().equals("text/html")) {
                txtAreaDescription.setContentType("text/plain");
            }
        }

        txtAreaImpact.setText("");

        txtAreaStepsToReproduce.setText("");
        if (!txtAreaStepsToReproduce.isEnabled()) {
            txtAreaStepsToReproduce.setEnabled(true);
            if (txtAreaStepsToReproduce.getContentType().equals("text/html")) {
                txtAreaStepsToReproduce.setContentType("text/plain");
            }

        }

        txtAreaCompromisedEnvironment.setText("");
        noCompromisedEnvironmentRButton.setSelected(true);
        scrollPaneCompromisedEnvironment.setVisible(false);
        txtAreaCompromisedEnvironment.setVisible(false);

        clearAssetSelection();

        txtFieldMethod.setText("");
        if (!txtFieldMethod.isEnabled()) {
            txtFieldMethod.setEnabled(true);
        }

        txtFieldProtocol.setText("");
        if (!txtFieldProtocol.isEnabled()) {
            txtFieldProtocol.setEnabled(true);
        }

        txtFieldUrl.setText("");
        if (!txtFieldUrl.isEnabled()) {
            txtFieldUrl.setEnabled(true);
        }

        parametersListModel.clear();

        txtAreaRequest.setText("");
        if (!txtAreaRequest.isEnabled()) {
            txtAreaRequest.setEnabled(true);
        }

        txtAreaResponse.setText("");
        if (!txtAreaResponse.isEnabled()) {
            txtAreaResponse.setEnabled(true);
        }

        evidenceListModel.clear();
        listEvidence.putClientProperty("html.disable", Boolean.FALSE);
        evidenceListModel.addElement(new AttachmentArchive(evidencePlaceholder, evidencePlaceholder));

        this.notificationTemplateSelected(false);

        AutoFilterComboboxModel autoFilterComboboxModel = (AutoFilterComboboxModel) this.cbVulnerabilityTemplates.getModel();
        if (autoFilterComboboxModel.getSize() > 0) {
            autoFilterComboboxModel.filterList("", false);
            this.cbVulnerabilityTemplates.setSelectedIndex(0);
        }

        if (!this.btnSubmitForm.isEnabled()) {
            this.btnSubmitForm.setEnabled(true);
        }

        this.previewMarkdownDescription = false;
        this.previewMarkdownImpact = false;
        this.previewMarkdownStepsToReproduce = false;
        updatePreviewButton(btnPreviewDescription, false);
        updatePreviewButton(btnPreviewImpact, false);
        updatePreviewButton(btnPreviewStepsToReproduce, false);
    }

    private void setBoldTitleTab(JTabbedPane tabbedPane) {
        for (int i = 0; i < tabbedPane.getTabCount(); i++) {
            String tabTitle = tabbedPane.getTitleAt(i);
            if (tabTitle.contains("style=\"color:red\"") || tabTitle.contains("style=\"color:orange\"")) {
                if (i == tabbedPane.getSelectedIndex()) {
                    if (this.isDarkBackground) {
                        tabbedPane.setTitleAt(i, String.format(defaultRequiredSelectedTabTitleDarkBackground, this.cleanTabTitle(tabbedPane.getTitleAt(i))));
                    } else {
                        tabbedPane.setTitleAt(i, String.format(defaultRequiredSelectedTabTitle, this.cleanTabTitle(tabbedPane.getTitleAt(i))));
                    }

                } else {
                    if (this.isDarkBackground) {
                        tabbedPane.setTitleAt(i, String.format(defaultRequiredTabTitleDarkBackground, this.cleanTabTitle(tabbedPane.getTitleAt(i))));
                    } else {
                        tabbedPane.setTitleAt(i, String.format(defaultRequiredTabTitle, this.cleanTabTitle(tabbedPane.getTitleAt(i))));
                    }
                }
            } else {
                if (i == tabbedPane.getSelectedIndex()) {
                    tabbedPane.setTitleAt(i, String.format(defaultSelectedTabTitle, this.cleanTabTitle(tabbedPane.getTitleAt(i))));
                } else {
                    tabbedPane.setTitleAt(i, String.format(defaultTabTitle, this.cleanTabTitle(tabbedPane.getTitleAt(i))));
                }
            }
        }
    }

    private void setRequiredTitleTab(JTabbedPane tabbedPane, String tabTitle) {
        if (this.isDarkBackground) {
            setTabTitle(tabbedPane, tabTitle, defaultRequiredSelectedTabTitleDarkBackground, defaultRequiredTabTitleDarkBackground);
        } else {
            setTabTitle(tabbedPane, tabTitle, defaultRequiredSelectedTabTitle, defaultRequiredTabTitle);
        }
    }

    private void removeRequiredTitleTab(JTabbedPane tabbedPane, String tabTitle) {
        setTabTitle(tabbedPane, tabTitle, defaultSelectedTabTitle, defaultTabTitle);
    }

    private void setTabTitle(JTabbedPane tabbedPane, String tabTitle, String defaultSelectedTabTitle, String defaultTabTitle) {
        for (int i = 0; i < tabbedPane.getTabCount(); i++) {
            if (tabbedPane.getTitleAt(i).contains(tabTitle)) {
                if (i == tabbedPane.getSelectedIndex()) {
                    tabbedPane.setTitleAt(i, String.format(defaultSelectedTabTitle, this.cleanTabTitle(tabbedPane.getTitleAt(i))));
                } else {
                    tabbedPane.setTitleAt(i, String.format(defaultTabTitle, this.cleanTabTitle(tabbedPane.getTitleAt(i))));
                }
            }
        }
    }

    private String cleanTabTitle(String tabTitle) {
        return tabTitle.replaceAll("(<.+?>)+", "").replace("*", "");
    }

    private int getDefinedTemplateId() {
        int templateId = 0;
        try {
            templateId = ((Template) autoFilterComboboxModel.getSelectedItem()).getId();
        } catch (NullPointerException | ClassCastException ignored) {
        }

        if (templateId == 0) {
            return 0;
        } else {
            this.setLblDefault(new JLabel[]{lblVulnerabilityTemplate}, this.rootPanel);
            return templateId;
        }
    }

    private String getDefinedImpact() {
        if (this.impactHighRButton.isSelected()) {
            this.setLblDefault(new JLabel[]{lblImpact}, this.rootPanel);
            return this.impactHighRButton.getText().toLowerCase();
        } else if (this.impactMediumRButton.isSelected()) {
            this.setLblDefault(new JLabel[]{lblImpact}, this.rootPanel);
            return this.impactMediumRButton.getText().toLowerCase();
        } else if (this.impactLowRButton.isSelected()) {
            this.setLblDefault(new JLabel[]{lblImpact}, this.rootPanel);
            return this.impactLowRButton.getText().toLowerCase();
        } else {
            this.setLblDefault(new JLabel[]{lblImpact}, this.rootPanel);
            return null;
        }
    }

    private String getDefinedProbability() {
        if (this.probabilityHighRButton.isSelected()) {
            this.setLblDefault(new JLabel[]{lblProbability}, this.rootPanel);
            return this.probabilityHighRButton.getText().toLowerCase();
        } else if (this.probabilityMediumRButton.isSelected()) {
            this.setLblDefault(new JLabel[]{lblProbability}, this.rootPanel);
            return this.probabilityMediumRButton.getText().toLowerCase();
        } else if (this.probabilityLowRButton.isSelected()) {
            this.setLblDefault(new JLabel[]{lblProbability}, this.rootPanel);
            return this.probabilityLowRButton.getText().toLowerCase();
        } else {
            this.setLblDefault(new JLabel[]{lblProbability}, this.rootPanel);
            return null;
        }
    }

    private Boolean getCompromisedEnvironment() {
        if (this.yesCompromisedEnvironmentRButton.isSelected()) {
            return true;
        } else if (this.noCompromisedEnvironmentRButton.isSelected()) {
            return false;
        } else {
            return null;
        }
    }

    private String getCompromisedEnvironmentText() {
        if ((getCompromisedEnvironment() == null || getCompromisedEnvironment()) && txtAreaCompromisedEnvironment.getText().isEmpty()) {
            this.setLblDefault(new JLabel[]{lblCompromisedEnvironment}, this.rootPanel);
            return null;
        } else {
            this.setLblDefault(new JLabel[]{lblCompromisedEnvironment}, this.rootPanel);
            return txtAreaCompromisedEnvironment.getText();
        }
    }

    private String getDescription() {
        if (txtAreaDescription.getText().isEmpty()) {
            this.setRequiredTitleTab(tabDescriptionImpactSteps, "Description");
            return null;
        } else {
            this.removeRequiredTitleTab(tabDescriptionImpactSteps, "Description");
            if (this.previewMarkdownDescription) {
                togglePreviewDescription();
            }
            Node document = parser.parse(txtAreaDescription.getText().replaceAll("\\r?\\n", "</p><p>"));
            return renderer.render(document).replace("\n", "");
        }
    }

    private String getImpactDescription() {
        if (txtAreaImpact.getText().isEmpty()) {
            this.setRequiredTitleTab(tabDescriptionImpactSteps, "Impact");
            return null;
        } else {
            this.removeRequiredTitleTab(tabDescriptionImpactSteps, "Impact");
            if (this.previewMarkdownImpact) {
                togglePreviewImpact();
            }
            Node document = parser.parse(txtAreaImpact.getText().replaceAll("\\r?\\n", "</p><p>"));
            return renderer.render(document).replace("\n", "");
        }
    }

    private String getStepsToReproduce() {
        if (txtAreaStepsToReproduce.getText().isEmpty()) {
            this.setRequiredTitleTab(tabDescriptionImpactSteps, "Steps to reproduce");
            return null;
        } else {
            this.removeRequiredTitleTab(tabDescriptionImpactSteps, "Steps to reproduce");
            if (this.previewMarkdownStepsToReproduce) {
                togglePreviewDescription();
            }
            Node document = parser.parse(txtAreaStepsToReproduce.getText().replaceAll("\\r?\\n", "</p><p>"));
            return renderer.render(document).replace("\n", "");

        }
    }

    private Integer getProjectId() {
        String rawValue = callbacks.loadExtensionSetting(CONVISO_PROJECT_ID);
        if (rawValue == null || rawValue.trim().isEmpty()) {
            JOptionPane.showMessageDialog(rootPanel2, "Please select a project in Settings.");
            return null;
        }
        try {
            return Integer.parseInt(rawValue.trim());
        } catch (NumberFormatException ex) {
            JOptionPane.showMessageDialog(rootPanel2, "Project ID in Settings must be a number!");
            return null;
        }
    }

    private void refreshProjectHeaderAsync() {
        String rawProjectId = callbacks.loadExtensionSetting(CONVISO_PROJECT_ID);
        if (rawProjectId == null || rawProjectId.trim().isEmpty()) {
            lblProjectId.setText("No project selected.");
            return;
        }
        lblProjectId.setText("Project " + rawProjectId.trim() + " (loading...)");
        new Thread(() -> {
            try {
                Project project = servicesManager.getProjectService().getProjectById(Integer.parseInt(rawProjectId.trim()));
                SwingUtilities.invokeLater(() -> {
                    if (project == null) {
                        lblProjectId.setText("Project " + rawProjectId.trim() + " not found.");
                    } else {
                        lblProjectId.setText(project.getPid() + " - " + project.getLabel());
                    }
                });
            } catch (NumberFormatException ex) {
                SwingUtilities.invokeLater(() -> lblProjectId.setText("Project " + rawProjectId.trim() + " (invalid ID)"));
            } catch (AuthenticationException ex) {
                SwingUtilities.invokeLater(() -> lblProjectId.setText("Project " + rawProjectId.trim() + " (auth error)"));
            }
        }).start();
    }

    private Integer getAssetId() {
        Object selected = cbAssets.getSelectedItem();
        if (selected instanceof Asset) {
            this.setLblDefault(new JLabel[]{lblAssetId}, this.rootPanel);
            return ((Asset) selected).getId();
        }
        JTextField assetEditor = (JTextField) cbAssets.getEditor().getEditorComponent();
        String rawValue = assetEditor.getText();
        if (rawValue == null || rawValue.trim().isEmpty()) {
            this.setLblDefault(new JLabel[]{lblAssetId}, this.rootPanel);
            return null;
        }
        try {
            String trimmed = rawValue.trim();
            int separatorIndex = trimmed.indexOf(" - ");
            if (separatorIndex > 0) {
                trimmed = trimmed.substring(0, separatorIndex);
            }
            return Integer.parseInt(trimmed);
        } catch (NumberFormatException ex) {
            this.setLblDefault(new JLabel[]{lblAssetId}, this.rootPanel);
            JOptionPane.showMessageDialog(rootPanel2, "Asset ID must be a number!");
            return null;
        }
    }

    private void clearAssetSelection() {
        cbAssets.setSelectedItem(null);
        JTextField assetEditor = (JTextField) cbAssets.getEditor().getEditorComponent();
        assetEditor.setText("");
        assetsComboboxModel.filterList("", false);
    }

    private String getProtocol() {
        if (txtFieldProtocol.getText().isEmpty()) {
            this.setLblDefault(new JLabel[]{lblProtocol}, this.rootPanel);
            return null;
        } else {
            this.setLblDefault(new JLabel[]{lblProtocol}, this.rootPanel);
            return txtFieldProtocol.getText();
        }
    }

    private String getMethod() {
        if (txtFieldMethod.getText().isEmpty()) {
            this.setLblDefault(new JLabel[]{lblMethod}, this.rootPanel);
            return null;
        } else {
            this.setLblDefault(new JLabel[]{lblMethod}, this.rootPanel);
            return txtFieldMethod.getText();

        }
    }

    private String getUrl() {
        if (txtFieldUrl.getText().isEmpty()) {
            this.setLblDefault(new JLabel[]{lblUrl}, this.rootPanel);
            return null;
        } else {
            this.setLblDefault(new JLabel[]{lblUrl}, this.rootPanel);
            return txtFieldUrl.getText();
        }
    }

    private Integer getPort(String url, String protocol) {
        Integer parsedPort = parsePortFromUrl(url);
        if (parsedPort != null) {
            return parsedPort;
        }

        String defaultPort = "80";
        if (protocol != null && (protocol.equalsIgnoreCase("https") || protocol.equalsIgnoreCase("wss"))) {
            defaultPort = "443";
        }

        String input = JOptionPane.showInputDialog(rootPanel2, "Port", defaultPort);
        if (input == null) {
            return null;
        }
        String trimmed = input.trim();
        if (trimmed.isEmpty()) {
            trimmed = defaultPort;
        }
        try {
            int port = Integer.parseInt(trimmed);
            if (port > 0) {
                return port;
            }
        } catch (NumberFormatException ignored) {
        }
        JOptionPane.showMessageDialog(rootPanel2, "Port must be a number!");
        return null;
    }

    private Integer parsePortFromUrl(String url) {
        if (url == null || url.isEmpty()) {
            return null;
        }
        try {
            if (url.contains("://")) {
                URI uri = new URI(url);
                int port = uri.getPort();
                return port > 0 ? port : null;
            }
            int slashIndex = url.indexOf('/');
            String hostPort = slashIndex > -1 ? url.substring(0, slashIndex) : url;
            int colonIndex = hostPort.lastIndexOf(':');
            if (colonIndex > 0 && colonIndex < hostPort.length() - 1) {
                return Integer.parseInt(hostPort.substring(colonIndex + 1));
            }
        } catch (Exception ignored) {
        }
        return null;
    }

    private String getRequest() {
        if (txtAreaRequest.getText().isEmpty()) {
            this.setRequiredTitleTab(tabParametersRequestResponse, "Request");
            return null;
        } else {
            this.removeRequiredTitleTab(tabParametersRequestResponse, "Request");
            return txtAreaRequest.getText().replace("\\", "\\\\");
        }
    }

    private String getResponse() {
        if (txtAreaResponse.getText().isEmpty()) {
            this.setRequiredTitleTab(tabParametersRequestResponse, "Response");
            return null;
        } else {
            this.removeRequiredTitleTab(tabParametersRequestResponse, "Response");
            return txtAreaResponse.getText().replace("\\", "\\\\");
        }
    }

    private ArrayList<AttachmentArchive> getEvidence() {
        ArrayList<AttachmentArchive> evidenceArchiveArrayList = new ArrayList<>();

        if (evidenceListModel.get(0).getName().equals(evidencePlaceholder)) {
            this.setRequiredTitleTab(tabDescriptionImpactSteps, "Attachment");
            return null;
        }

        for (int i = 0; i < evidenceListModel.getSize(); i++) {
            evidenceArchiveArrayList.add(evidenceListModel.get(i));
        }

        this.removeRequiredTitleTab(tabDescriptionImpactSteps, "Attachment");
        return evidenceArchiveArrayList;

    }

    public void addEvidence(AttachmentArchive evidenceArchive) {
        if (evidenceArchive.validateExtension()) {
            if (evidenceListModel.get(0).getName().equals(evidencePlaceholder)) {
                evidenceListModel.clear();
                listEvidence.putClientProperty("html.disable", Boolean.TRUE);
            }
            evidenceListModel.addElement(evidenceArchive);
            this.qtdEvidence++;
        } else {
            JOptionPane.showMessageDialog(this.getRootPanel2(), "Invalid extension!\n" +
                    "Please use: " + String.join(", ", AttachmentFileChooser.acceptedExtensions));
        }
    }

    public void removeSelectedEvidence() {
        if (this.listEvidence.getSelectedIndex() != -1) {
            this.evidenceListModel.remove(this.listEvidence.getSelectedIndex());
        }

        if (evidenceListModel.size() == 0) {
            listEvidence.putClientProperty("html.disable", Boolean.FALSE);
            evidenceListModel.addElement(new AttachmentArchive(evidencePlaceholder, evidencePlaceholder));
        }
    }

    private String getParameterListAsString() {
        StringBuilder toReturn = new StringBuilder();
        for (int i = 0; i < parametersListModel.getSize(); i++) {
            toReturn.append(parametersListModel.get(i)).append("<br>");
        }
        return toReturn.toString().trim();
    }

    public void setRequest(String req) {
        if (this.txtAreaRequest.isEnabled()) this.txtAreaRequest.setEnabled(false);
        this.txtAreaRequest.setText(req);
        this.txtAreaRequest.setCaretPosition(0);
    }

    public void setResponse(String resp) {
        if (this.txtAreaResponse.isEnabled()) this.txtAreaResponse.setEnabled(false);
        this.txtAreaResponse.setText(resp);
        this.txtAreaResponse.setCaretPosition(0);
    }

    public void setTxtFieldMethod(String method) {
        if (this.txtFieldMethod.isEnabled()) this.txtFieldMethod.setEnabled(false);
        this.txtFieldMethod.setText(method);
    }

    public void setTxtFieldUrl(String url) {
        if (this.txtFieldUrl.isEnabled()) this.txtFieldUrl.setEnabled(false);
        this.txtFieldUrl.setText(url);
    }

    public void setTxtFieldProtocol(String prot) {
        if (this.txtFieldProtocol.isEnabled()) this.txtFieldProtocol.setEnabled(false);
        this.txtFieldProtocol.setText(prot);
    }

    public void setListParameters(List<IParameter> params) {
        this.parametersListModel.clear();

        for (IParameter param : params) {
            this.parametersListModel.addElement(param.getName() + "=" + param.getValue());
        }
    }

    public Vulnerability validateNotification() {
        return validateVulnerability(true);
    }

    public Vulnerability validateVulnerability() {
        return validateVulnerability(false);
    }

    private Vulnerability validateVulnerability(boolean notification) {
        Vulnerability vulnerability = new Vulnerability();
        vulnerability.setNotification(notification);

        Integer projectId = getProjectId();
        if (projectId != null) {
            vulnerability.setProjectId(projectId);
        }

        Integer assetId = getAssetId();
        if (assetId != null) {
            vulnerability.setAssetId(assetId);
        }

        int templateId = getDefinedTemplateId();
        if (templateId != 0) {
            vulnerability.setVulnerabilityTemplateId(templateId);
        }

        String definedImpact = getDefinedImpact();
        if (definedImpact != null) {
            vulnerability.setImpact(definedImpact);
        }

        String definedProbability = getDefinedProbability();
        if (definedProbability != null) {
            vulnerability.setProbability(definedProbability);
        }

        Boolean definedCompromisedEnvironment = getCompromisedEnvironment();
        if (definedCompromisedEnvironment != null) {
            vulnerability.setInvaded(definedCompromisedEnvironment);
        }

        String definedCompromisedEnvironmentText = getCompromisedEnvironmentText();
        if (definedCompromisedEnvironmentText != null) {
            vulnerability.setInvadedEnvironmentDescription(definedCompromisedEnvironmentText);
        }

        String definedDescription = getDescription();
        if (definedDescription != null) {
            vulnerability.setDescription(definedDescription);
        }

        String definedImpactDescription = getImpactDescription();
        if (definedImpactDescription != null) {
            vulnerability.setImpactResume(definedImpactDescription);
        }

        String definedStepsToReproduce = getStepsToReproduce();
        if (definedStepsToReproduce != null) {
            vulnerability.setWebSteps(definedStepsToReproduce);
        }

        ArrayList<AttachmentArchive> definedEvidenceArchives = getEvidence();
        if (definedEvidenceArchives != null) {
            vulnerability.setAttachments(definedEvidenceArchives);
        }

        String definedMethod = getMethod();
        if (definedMethod != null) {
            vulnerability.setWebMethod(definedMethod);
        }

        String definedProtocol = getProtocol();
        if (definedProtocol != null) {
            vulnerability.setWebProtocol(definedProtocol);
        }

        String definedUrl = getUrl();
        if (definedUrl != null) {
            vulnerability.setWebUrl(definedUrl);
        }

        Integer definedPort = null;
        if (definedUrl != null && definedProtocol != null) {
            definedPort = getPort(definedUrl, definedProtocol);
            if (definedPort != null) {
                vulnerability.setWebPort(definedPort);
            }
        }

        vulnerability.setWebParameters(getParameterListAsString());

        String definedRequest = getRequest();
        if (definedRequest != null) {
            vulnerability.setWebRequest(definedRequest);
        }

        String definedResponse = getResponse();
        if (definedResponse != null) {
            vulnerability.setWebResponse(definedResponse);
        }

        Template templatePicked = null;
        try {
            templatePicked = (Template) autoFilterComboboxModel.getSelectedItem();
        } catch (ClassCastException ignored) {
        }

        String title = (templatePicked != null) ? templatePicked.getTitle() : null;
        if (title == null || title.isEmpty()) {
            title = (definedUrl != null && !definedUrl.isEmpty()) ? definedUrl : "Untitled vulnerability";
        }
        vulnerability.setTitle(title);

        String summary = (templatePicked != null) ? templatePicked.getImpact_resume() : null;
        if (summary == null || summary.isEmpty()) {
            summary = definedDescription;
        }
        vulnerability.setSummary(summary);

        String solution = (templatePicked != null) ? templatePicked.getSolution() : null;
        if (solution == null || solution.isEmpty()) {
            solution = definedDescription;
        }
        vulnerability.setSolution(solution);

        List<String> missingFields = new ArrayList<>();
        if (projectId == null) missingFields.add("Project");
        if (assetId == null) missingFields.add("Asset");
        if (definedImpact == null) missingFields.add("Impact");
        if (definedProbability == null) missingFields.add("Probability");
        if (definedCompromisedEnvironment == null) missingFields.add("Compromised environment");
        if (definedCompromisedEnvironmentText == null) missingFields.add("Compromised environment details");
        if (definedDescription == null) missingFields.add("Description");
        if (definedImpactDescription == null) missingFields.add("Impact description");
        if (definedStepsToReproduce == null) missingFields.add("Steps to reproduce");
        if (definedMethod == null) missingFields.add("Method");
        if (definedProtocol == null) missingFields.add("Protocol");
        if (definedUrl == null) missingFields.add("URL");
        if (definedRequest == null) missingFields.add("Request");
        if (definedResponse == null) missingFields.add("Response");
        if (definedPort == null) missingFields.add("Port");
        if (vulnerability.getTitle() == null) missingFields.add("Title");
        if (vulnerability.getSummary() == null) missingFields.add("Summary");
        if (vulnerability.getSolution() == null) missingFields.add("Solution");

        if (!missingFields.isEmpty()) {
            JOptionPane.showMessageDialog(rootPanel2, "Please fill in:\n- " + String.join("\n- ", missingFields));
            return null;
        } else {
            return vulnerability;
        }
    }

    private void notificationTemplateSelected(boolean isSelected) {
        probabilityHighRButton.setEnabled(true);
        probabilityMediumRButton.setEnabled(true);
        probabilityLowRButton.setEnabled(true);
        impactHighRButton.setEnabled(true);
        impactMediumRButton.setEnabled(true);
        impactLowRButton.setEnabled(true);
        yesCompromisedEnvironmentRButton.setEnabled(true);
        noCompromisedEnvironmentRButton.setEnabled(true);
        txtAreaImpact.setEnabled(true);
        txtAreaStepsToReproduce.setEnabled(true);
        btnPreviewStepsToReproduce.setEnabled(true);

        tabParametersRequestResponse.setEnabled(true);
        listParameters.setEnabled(true);
        btnRemoveParameter.setEnabled(true);
        btnRemoveAllParameters.setEnabled(true);
        btnRedactValue.setEnabled(true);
        btnImportParametersFromRequest.setEnabled(true);

        if (this.fromContextMenu) {
            txtFieldMethod.setEnabled(false);
            txtFieldProtocol.setEnabled(false);
            txtFieldUrl.setEnabled(false);
        } else {
            txtFieldMethod.setEnabled(true);
            txtFieldProtocol.setEnabled(true);
            txtFieldUrl.setEnabled(true);
        }

    }

    private void enableViewTemplate() {
        this.lblViewTemplate.setEnabled(false);
        this.lblViewTemplate.setVisible(false);
    }

    private void disableViewTemplate() {
        this.lblViewTemplate.setEnabled(false);
        this.lblViewTemplate.setVisible(false);
    }

    private void showInfoTemplateSelected() {
        Dimension defaultDimension = (Dimension) UIManager.get("OptionPane.minimumSize");
        try {
            Template templatePicked = (Template) autoFilterComboboxModel.getSelectedItem();

            UIManager.put("OptionPane.minimumSize", new Dimension(800, 800));

            ShowTemplateInformation showTemplateInformation = new ShowTemplateInformation();
            showTemplateInformation.setTitle(templatePicked.getTitle());
            showTemplateInformation.setCategories(templatePicked.getCategories());
            showTemplateInformation.setTxtFieldPatterns(templatePicked.getPatterns());
            showTemplateInformation.setVulnerabilityText(templatePicked.getDescription());
            showTemplateInformation.setVulnerabilityReferences(templatePicked.getReference());

            JOptionPane.showMessageDialog(this.getRootPanel2(), showTemplateInformation.$$$getRootComponent$$$(), "Template information", JOptionPane.PLAIN_MESSAGE);
        } catch (ClassCastException | NullPointerException ignored) {
            UIManager.put("OptionPane.minimumSize", defaultDimension);
            JOptionPane.showMessageDialog(this.getRootPanel2(), "Something went wrong, please try again.");
        } finally {
            UIManager.put("OptionPane.minimumSize", defaultDimension);
        }


    }

    private void applyTooltips() {
        cbVulnerabilityTemplates.setToolTipText("Select a vulnerability template to auto-fill fields.");
        lblProjectId.setToolTipText("Project selected in Settings.");
        cbAssets.setToolTipText("Select an asset linked to the project.");
        btnLoadAssets.setToolTipText("Load assets for the selected project.");
        txtFieldMethod.setToolTipText("HTTP method (GET, POST, etc.).");
        txtFieldProtocol.setToolTipText("Protocol (HTTP/HTTPS).");
        txtFieldUrl.setToolTipText("Target URL or host.");
        txtAreaRequest.setToolTipText("Raw HTTP request.");
        txtAreaResponse.setToolTipText("Raw HTTP response.");
        txtAreaDescription.setToolTipText("Vulnerability description.");
        txtAreaImpact.setToolTipText("Impact description.");
        txtAreaStepsToReproduce.setToolTipText("Steps to reproduce.");
        listEvidence.setToolTipText("Add attachments.");
    }

    private void showHelpDialog() {
        String message =
                "Quick steps:\n" +
                "1) Select a Project in Settings.\n" +
                "2) Load and choose an Asset.\n" +
                "3) Select a Vulnerability Template (optional).\n" +
                "4) Fill Description, Impact, Steps, and Request/Response.\n" +
                "5) Submit.";
        JOptionPane.showMessageDialog(rootPanel2, message, "How to create a vulnerability", JOptionPane.INFORMATION_MESSAGE);
    }

    private void togglePreviewDescription() {
        this.previewMarkdownDescription = !previewMarkdownDescription;
        previewMarkDownText(previewMarkdownDescription, "Description", txtAreaDescription);
        updatePreviewButton(btnPreviewDescription, previewMarkdownDescription);
    }

    private void togglePreviewImpact() {
        this.previewMarkdownImpact = !previewMarkdownImpact;
        previewMarkDownText(previewMarkdownImpact, "Impact", txtAreaImpact);
        updatePreviewButton(btnPreviewImpact, previewMarkdownImpact);
    }

    private void togglePreviewStepsToReproduce() {
        previewMarkdownStepsToReproduce = !previewMarkdownStepsToReproduce;
        previewMarkDownText(previewMarkdownStepsToReproduce, "Steps to Reproduce", txtAreaStepsToReproduce);
        updatePreviewButton(btnPreviewStepsToReproduce, previewMarkdownStepsToReproduce);
    }

    private void updatePreviewButton(JButton button, boolean previewEnabled) {
        if (button == null) {
            return;
        }
        button.setText(previewEnabled ? "Edit" : "Preview Markdown");
    }

    public DefaultListModel<AttachmentArchive> getEvidenceListModel() {
        return evidenceListModel;
    }

    public void setEvidenceListModel(DefaultListModel<AttachmentArchive> evidenceListModel) {
        this.evidenceListModel = evidenceListModel;
    }

    public JList getListEvidence() {
        return listEvidence;
    }

    public void setListEvidence(JList listEvidence) {
        this.listEvidence = listEvidence;
    }


    public boolean isFromContextMenu() {
        return fromContextMenu;
    }

    public void setFromContextMenu(boolean fromContextMenu) {
        this.fromContextMenu = fromContextMenu;
    }

    public JPanel getRootPanel2() {
        return rootPanel2;
    }

    public JButton getBtnSubmitForm() {
        return btnSubmitForm;
    }

    public int getQtdEvidence() {
        return qtdEvidence;
    }

    public void setQtdEvidence(int qtdEvidence) {
        this.qtdEvidence = qtdEvidence;
    }

    {
// GUI initializer generated by IntelliJ IDEA GUI Designer
// >>> IMPORTANT!! <<<
// DO NOT EDIT OR ADD ANY CODE HERE!
        $$$setupUI$$$();
    }

    /**
     * Method generated by IntelliJ IDEA GUI Designer
     * >>> IMPORTANT!! <<<
     * DO NOT edit this method OR call it in your code!
     *
     * @noinspection ALL
     */
    private void $$$setupUI$$$() {
        rootPanel = new JScrollPane();
        rootPanel2 = new JPanel();
        rootPanel2.setLayout(new FormLayout("fill:max(d;4px):noGrow,left:75dlu:grow,fill:138px:noGrow,left:16dlu:noGrow,fill:88px:noGrow,left:5dlu:noGrow,fill:58px:noGrow,left:7dlu:noGrow,fill:max(d;4px):noGrow,left:14dlu:noGrow,left:10dlu:noGrow,fill:255px:noGrow,left:13dlu:noGrow,fill:10px:noGrow,left:27dlu:noGrow,left:4dlu:noGrow,fill:97px:grow", "center:13px:noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow,center:24px:noGrow,center:max(d;4px):noGrow,center:max(d;4px):noGrow,center:15px:noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow,top:4dlu:noGrow,top:5dlu:noGrow,center:58px:noGrow,center:9px:noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow,center:138px:grow,top:6dlu:noGrow,center:11px:noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow,top:4dlu:noGrow,top:35dlu:noGrow,center:13px:noGrow,center:11px:noGrow,top:4dlu:noGrow,center:206px:grow,center:max(d;4px):noGrow,center:max(d;4px):noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow,center:max(d;4px):noGrow"));
        rootPanel.setViewportView(rootPanel2);
        final JPanel panel1 = new JPanel();
        panel1.setLayout(new FormLayout("fill:575px:grow,left:7dlu:noGrow,fill:max(d;4px):noGrow", "center:d:noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow,top:6dlu:noGrow,center:max(d;4px):noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow,top:6dlu:noGrow,center:max(d;4px):noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow"));
        CellConstraints cc = new CellConstraints();
        rootPanel2.add(panel1, cc.xyw(3, 3, 13));
        lblProjectId = new JLabel();
        Font lblProjectIdFont = this.$$$getFont$$$(null, Font.BOLD, -1, lblProjectId.getFont());
        if (lblProjectIdFont != null) lblProjectId.setFont(lblProjectIdFont);
        lblProjectId.setText("Project");
        panel1.add(lblProjectId, cc.xy(1, 1));
        txtFieldProjectId = new JTextField();
        txtFieldProjectId.putClientProperty("html.disable", Boolean.TRUE);
        panel1.add(txtFieldProjectId, cc.xy(1, 3, CellConstraints.FILL, CellConstraints.DEFAULT));
        lblVulnerabilityTemplate = new JLabel();
        Font lblVulnerabilityTemplateFont = this.$$$getFont$$$(null, Font.BOLD, -1, lblVulnerabilityTemplate.getFont());
        if (lblVulnerabilityTemplateFont != null) lblVulnerabilityTemplate.setFont(lblVulnerabilityTemplateFont);
        lblVulnerabilityTemplate.setText("Vulnerability Template");
        panel1.add(lblVulnerabilityTemplate, cc.xy(1, 5));
        cbVulnerabilityTemplates = new JComboBox();
        cbVulnerabilityTemplates.setEditable(true);
        cbVulnerabilityTemplates.putClientProperty("html.disable", Boolean.TRUE);
        panel1.add(cbVulnerabilityTemplates, cc.xy(1, 7));
        btnRefreshVT = new JButton();
        btnRefreshVT.setText("Load templates");
        panel1.add(btnRefreshVT, cc.xy(3, 7));
        lblAssetId = new JLabel();
        Font lblAssetIdFont = this.$$$getFont$$$(null, Font.BOLD, -1, lblAssetId.getFont());
        if (lblAssetIdFont != null) lblAssetId.setFont(lblAssetIdFont);
        lblAssetId.setText("Asset");
        panel1.add(lblAssetId, cc.xy(1, 9));
        cbAssets = new JComboBox();
        cbAssets.setEditable(true);
        cbAssets.putClientProperty("html.disable", Boolean.TRUE);
        panel1.add(cbAssets, cc.xy(1, 11, CellConstraints.FILL, CellConstraints.DEFAULT));
        btnLoadAssets = new JButton();
        btnLoadAssets.setText("Load assets");
        panel1.add(btnLoadAssets, cc.xy(3, 11));
        final JPanel panel2 = new JPanel();
        panel2.setLayout(new FormLayout("fill:65px:noGrow,left:5dlu:noGrow,fill:70px:noGrow,left:6dlu:noGrow,fill:43px:noGrow,left:10dlu:noGrow,fill:465px:grow,fill:max(d;4px):noGrow,fill:17px:noGrow", "center:max(d;4px):noGrow,top:4dlu:noGrow,center:16px:noGrow,top:5dlu:noGrow,center:30px:noGrow"));
        rootPanel2.add(panel2, cc.xywh(3, 18, 13, 5));
        lblMethod = new JLabel();
        Font lblMethodFont = this.$$$getFont$$$(null, Font.BOLD, -1, lblMethod.getFont());
        if (lblMethodFont != null) lblMethod.setFont(lblMethodFont);
        lblMethod.setText("Method");
        panel2.add(lblMethod, cc.xyw(1, 3, 2));
        txtFieldMethod = new JTextField();
        txtFieldMethod.putClientProperty("html.disable", Boolean.TRUE);
        panel2.add(txtFieldMethod, cc.xy(1, 5, CellConstraints.FILL, CellConstraints.DEFAULT));
        lblProtocol = new JLabel();
        Font lblProtocolFont = this.$$$getFont$$$(null, Font.BOLD, -1, lblProtocol.getFont());
        if (lblProtocolFont != null) lblProtocol.setFont(lblProtocolFont);
        lblProtocol.setText("Protocol");
        panel2.add(lblProtocol, cc.xyw(3, 3, 2));
        lblUrl = new JLabel();
        Font lblUrlFont = this.$$$getFont$$$(null, Font.BOLD, -1, lblUrl.getFont());
        if (lblUrlFont != null) lblUrl.setFont(lblUrlFont);
        lblUrl.setText("URI");
        panel2.add(lblUrl, cc.xy(5, 3));
        txtFieldProtocol = new JTextField();
        txtFieldProtocol.putClientProperty("html.disable", Boolean.TRUE);
        panel2.add(txtFieldProtocol, cc.xy(3, 5, CellConstraints.FILL, CellConstraints.DEFAULT));
        txtFieldUrl = new JTextField();
        txtFieldUrl.putClientProperty("html.disable", Boolean.TRUE);
        panel2.add(txtFieldUrl, cc.xyw(5, 5, 3, CellConstraints.FILL, CellConstraints.DEFAULT));
        final JPanel panel3 = new JPanel();
        panel3.setLayout(new FormLayout("fill:16px:grow", "center:d:grow"));
        panel2.add(panel3, cc.xy(9, 5, CellConstraints.DEFAULT, CellConstraints.FILL));
        lblCopyUri = new JLabel();
        lblCopyUri.setIcon(new ImageIcon(getClass().getResource("/icons/copy-lightbkg.png")));
        lblCopyUri.setText("");
        lblCopyUri.setToolTipText("Copy URI");
        panel3.add(lblCopyUri, cc.xy(1, 1));
        final JPanel panel4 = new JPanel();
        panel4.setLayout(new FormLayout("fill:138px:noGrow,left:16dlu:noGrow,fill:88px:noGrow,left:5dlu:noGrow,fill:58px:noGrow,left:7dlu:noGrow,fill:max(d;4px):noGrow,left:14dlu:noGrow,left:199dlu:noGrow", "center:max(d;4px):noGrow,center:15px:noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow,top:4dlu:noGrow,top:5dlu:noGrow,center:54px:noGrow"));
        rootPanel2.add(panel4, cc.xywh(3, 6, 13, 7));
        final JPanel panel5 = new JPanel();
        panel5.setLayout(new FormLayout("fill:86px:noGrow,left:8dlu:noGrow,fill:110px:noGrow,left:6dlu:noGrow,fill:105px:noGrow", "center:max(d;4px):noGrow,top:4dlu:noGrow,center:21px:noGrow"));
        panel4.add(panel5, cc.xywh(1, 1, 6, 6));
        probabilityLowRButton = new JRadioButton();
        probabilityLowRButton.setText("Low");
        panel5.add(probabilityLowRButton, cc.xy(1, 3));
        probabilityMediumRButton = new JRadioButton();
        probabilityMediumRButton.setText("Medium");
        panel5.add(probabilityMediumRButton, cc.xy(3, 3));
        probabilityHighRButton = new JRadioButton();
        probabilityHighRButton.setText("High");
        panel5.add(probabilityHighRButton, cc.xy(5, 3));
        lblProbability = new JLabel();
        Font lblProbabilityFont = this.$$$getFont$$$(null, Font.BOLD, -1, lblProbability.getFont());
        if (lblProbabilityFont != null) lblProbability.setFont(lblProbabilityFont);
        lblProbability.setText("Probability");
        panel5.add(lblProbability, cc.xyw(1, 1, 3));
        final JPanel panel6 = new JPanel();
        panel6.setLayout(new FormLayout("fill:86px:noGrow,left:8dlu:noGrow,fill:110px:noGrow,left:7dlu:noGrow,fill:105px:noGrow", "center:max(d;4px):noGrow,top:4dlu:noGrow,center:21px:noGrow"));
        panel4.add(panel6, cc.xyw(1, 7, 6));
        impactLowRButton = new JRadioButton();
        impactLowRButton.setText("Low");
        panel6.add(impactLowRButton, cc.xy(1, 3));
        impactMediumRButton = new JRadioButton();
        impactMediumRButton.setText("Medium");
        panel6.add(impactMediumRButton, cc.xy(3, 3));
        impactHighRButton = new JRadioButton();
        impactHighRButton.setText("High");
        panel6.add(impactHighRButton, cc.xy(5, 3));
        lblImpact = new JLabel();
        Font lblImpactFont = this.$$$getFont$$$(null, Font.BOLD, -1, lblImpact.getFont());
        if (lblImpactFont != null) lblImpact.setFont(lblImpactFont);
        lblImpact.setText("Impact");
        panel6.add(lblImpact, cc.xyw(1, 1, 3));
        final JPanel panel7 = new JPanel();
        panel7.setLayout(new FormLayout("fill:52px:noGrow,left:6dlu:noGrow,fill:294px:noGrow", "center:max(d;4px):noGrow,top:7dlu:noGrow,center:27px:noGrow,top:7dlu:noGrow,center:25px:noGrow"));
        panel4.add(panel7, cc.xywh(9, 1, 1, 7));
        noCompromisedEnvironmentRButton = new JRadioButton();
        noCompromisedEnvironmentRButton.setSelected(true);
        noCompromisedEnvironmentRButton.setText("No");
        panel7.add(noCompromisedEnvironmentRButton, cc.xyw(1, 5, 2));
        lblCompromisedEnvironment = new JLabel();
        Font lblCompromisedEnvironmentFont = this.$$$getFont$$$(null, Font.BOLD, -1, lblCompromisedEnvironment.getFont());
        if (lblCompromisedEnvironmentFont != null) lblCompromisedEnvironment.setFont(lblCompromisedEnvironmentFont);
        lblCompromisedEnvironment.setText("Compromised Environment");
        panel7.add(lblCompromisedEnvironment, cc.xyw(1, 1, 3));
        yesCompromisedEnvironmentRButton = new JRadioButton();
        yesCompromisedEnvironmentRButton.setText("Yes");
        panel7.add(yesCompromisedEnvironmentRButton, cc.xyw(1, 3, 2));
        scrollPaneCompromisedEnvironment = new JScrollPane();
        scrollPaneCompromisedEnvironment.setVisible(false);
        panel7.add(scrollPaneCompromisedEnvironment, cc.xywh(3, 3, 1, 3, CellConstraints.FILL, CellConstraints.FILL));
        txtAreaCompromisedEnvironment = new JTextArea();
        txtAreaCompromisedEnvironment.setLineWrap(true);
        txtAreaCompromisedEnvironment.setVisible(false);
        scrollPaneCompromisedEnvironment.setViewportView(txtAreaCompromisedEnvironment);
        final JSeparator separator1 = new JSeparator();
        separator1.setOrientation(1);
        panel4.add(separator1, cc.xywh(7, 1, 1, 7, CellConstraints.FILL, CellConstraints.FILL));
        tabDescriptionImpactSteps = new JTabbedPane();
        rootPanel2.add(tabDescriptionImpactSteps, cc.xywh(3, 14, 13, 4, CellConstraints.DEFAULT, CellConstraints.FILL));
        tabDescriptionImpactSteps.setBorder(BorderFactory.createTitledBorder(BorderFactory.createEmptyBorder(), null, TitledBorder.DEFAULT_JUSTIFICATION, TitledBorder.DEFAULT_POSITION, null, null));
        final JPanel panel8 = new JPanel();
        panel8.setLayout(new FormLayout("fill:d:grow", "center:84px:grow,top:4dlu:noGrow,center:max(d;4px):noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow"));
        tabDescriptionImpactSteps.addTab("Description", panel8);
        final JScrollPane scrollPane1 = new JScrollPane();
        panel8.add(scrollPane1, cc.xy(1, 1, CellConstraints.FILL, CellConstraints.FILL));
        txtAreaDescription = new JEditorPane();
        txtAreaDescription.setContentType("text/plain");
        scrollPane1.setViewportView(txtAreaDescription);
        final JLabel labelMarkdownDescription = new JLabel();
        labelMarkdownDescription.setText("Markdown supported");
        panel8.add(labelMarkdownDescription, cc.xy(1, 3));
        btnPreviewDescription = new JButton();
        btnPreviewDescription.setText("Preview Markdown");
        panel8.add(btnPreviewDescription, cc.xy(1, 5));
        final JPanel panel9 = new JPanel();
        panel9.setLayout(new FormLayout("fill:d:grow", "center:84px:grow,top:4dlu:noGrow,center:max(d;4px):noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow"));
        tabDescriptionImpactSteps.addTab("Impact", panel9);
        final JScrollPane scrollPane2 = new JScrollPane();
        panel9.add(scrollPane2, cc.xy(1, 1, CellConstraints.FILL, CellConstraints.FILL));
        txtAreaImpact = new JEditorPane();
        scrollPane2.setViewportView(txtAreaImpact);
        final JLabel labelMarkdownImpact = new JLabel();
        labelMarkdownImpact.setText("Markdown supported");
        panel9.add(labelMarkdownImpact, cc.xy(1, 3));
        btnPreviewImpact = new JButton();
        btnPreviewImpact.setText("Preview Markdown");
        panel9.add(btnPreviewImpact, cc.xy(1, 5));
        final JPanel panel10 = new JPanel();
        panel10.setLayout(new FormLayout("fill:d:grow", "center:84px:grow,top:4dlu:noGrow,center:max(d;4px):noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow"));
        tabDescriptionImpactSteps.addTab("Steps to reproduce", panel10);
        final JScrollPane scrollPane3 = new JScrollPane();
        panel10.add(scrollPane3, cc.xy(1, 1, CellConstraints.FILL, CellConstraints.FILL));
        txtAreaStepsToReproduce = new JEditorPane();
        txtAreaStepsToReproduce.setContentType("text/plain");
        scrollPane3.setViewportView(txtAreaStepsToReproduce);
        final JLabel labelMarkdownSteps = new JLabel();
        labelMarkdownSteps.setText("Markdown supported");
        panel10.add(labelMarkdownSteps, cc.xy(1, 3));
        btnPreviewStepsToReproduce = new JButton();
        btnPreviewStepsToReproduce.setText("Preview Markdown");
        panel10.add(btnPreviewStepsToReproduce, cc.xy(1, 5));
        final JPanel panel11 = new JPanel();
        panel11.setLayout(new FormLayout("fill:708px:grow", "center:125px:grow,top:4dlu:noGrow,center:max(d;4px):noGrow"));
        tabDescriptionImpactSteps.addTab("Attachment", panel11);
        final JScrollPane scrollPane4 = new JScrollPane();
        panel11.add(scrollPane4, cc.xy(1, 1, CellConstraints.DEFAULT, CellConstraints.FILL));
        listEvidence = new JList();
        listEvidence.putClientProperty("List.isFileList", Boolean.TRUE);
        listEvidence.putClientProperty("html.disable", Boolean.FALSE);
        scrollPane4.setViewportView(listEvidence);
        final JPanel panelAttachmentActions = new JPanel();
        panelAttachmentActions.setLayout(new FormLayout("fill:max(d;4px):noGrow,left:6dlu:noGrow,fill:d:grow", "center:d:noGrow"));
        panel11.add(panelAttachmentActions, cc.xy(1, 3));
        btnAddAttachment = new JButton();
        btnAddAttachment.setText("Add attachment");
        panelAttachmentActions.add(btnAddAttachment, cc.xy(1, 1));
        lblAttachmentHint = new JLabel();
        lblAttachmentHint.setText("Right click also works");
        panelAttachmentActions.add(lblAttachmentHint, cc.xy(3, 1));
        tabParametersRequestResponse = new JTabbedPane();
        Font tabParametersRequestResponseFont = this.$$$getFont$$$(null, -1, -1, tabParametersRequestResponse.getFont());
        if (tabParametersRequestResponseFont != null)
            tabParametersRequestResponse.setFont(tabParametersRequestResponseFont);
        tabParametersRequestResponse.setTabLayoutPolicy(0);
        tabParametersRequestResponse.setTabPlacement(1);
        rootPanel2.add(tabParametersRequestResponse, cc.xywh(3, 24, 13, 3, CellConstraints.DEFAULT, CellConstraints.FILL));
        tabParametersRequestResponse.setBorder(BorderFactory.createTitledBorder(BorderFactory.createEmptyBorder(), null, TitledBorder.DEFAULT_JUSTIFICATION, TitledBorder.DEFAULT_POSITION, null, null));
        final JPanel panel12 = new JPanel();
        panel12.setLayout(new FormLayout("fill:713px:grow", "top:148px:grow,center:max(d;4px):noGrow"));
        Font panel12Font = this.$$$getFont$$$(null, -1, -1, panel12.getFont());
        if (panel12Font != null) panel12.setFont(panel12Font);
        tabParametersRequestResponse.addTab("Parameters", panel12);
        final JScrollPane scrollPane5 = new JScrollPane();
        panel12.add(scrollPane5, cc.xy(1, 1, CellConstraints.FILL, CellConstraints.FILL));
        listParameters = new JList();
        listParameters.putClientProperty("html.disable", Boolean.TRUE);
        scrollPane5.setViewportView(listParameters);
        final JPanel panel13 = new JPanel();
        panel13.setLayout(new FormLayout("fill:100px:noGrow,left:4dlu:noGrow,fill:116px:noGrow,left:4dlu:noGrow,fill:max(d;4px):noGrow,left:4dlu:noGrow,fill:max(d;4px):noGrow", "center:46px:noGrow"));
        panel12.add(panel13, cc.xy(1, 2, CellConstraints.DEFAULT, CellConstraints.BOTTOM));
        btnRemoveAllParameters = new JButton();
        btnRemoveAllParameters.setText("Remove All");
        panel13.add(btnRemoveAllParameters, cc.xy(3, 1));
        btnRemoveParameter = new JButton();
        btnRemoveParameter.setText("Remove");
        panel13.add(btnRemoveParameter, cc.xy(1, 1));
        btnRedactValue = new JButton();
        btnRedactValue.setText("Redact Value");
        panel13.add(btnRedactValue, cc.xy(5, 1));
        btnImportParametersFromRequest = new JButton();
        btnImportParametersFromRequest.setText("Import from request");
        panel13.add(btnImportParametersFromRequest, cc.xy(7, 1));
        final JPanel panel14 = new JPanel();
        panel14.setLayout(new FormLayout("fill:d:grow", "center:193px:grow"));
        tabParametersRequestResponse.addTab("Request", panel14);
        final JScrollPane scrollPane6 = new JScrollPane();
        panel14.add(scrollPane6, cc.xy(1, 1, CellConstraints.DEFAULT, CellConstraints.FILL));
        txtAreaRequest = new JTextArea();
        txtAreaRequest.putClientProperty("html.disable", Boolean.TRUE);
        scrollPane6.setViewportView(txtAreaRequest);
        final JPanel panel15 = new JPanel();
        panel15.setLayout(new FormLayout("fill:270px:grow", "center:193px:grow"));
        tabParametersRequestResponse.addTab("Response", panel15);
        final JScrollPane scrollPane7 = new JScrollPane();
        panel15.add(scrollPane7, cc.xy(1, 1, CellConstraints.DEFAULT, CellConstraints.FILL));
        txtAreaResponse = new JTextArea();
        txtAreaResponse.putClientProperty("html.disable", Boolean.TRUE);
        scrollPane7.setViewportView(txtAreaResponse);
        final JPanel panel16 = new JPanel();
        panel16.setLayout(new FormLayout("fill:max(d;4px):noGrow,left:4dlu:grow,fill:max(d;4px):noGrow,left:4dlu:noGrow,fill:max(d;4px):noGrow", "center:d:noGrow"));
        rootPanel2.add(panel16, cc.xyw(3, 30, 13));
        btnHelp = new JButton();
        btnHelp.setText("Help");
        panel16.add(btnHelp, cc.xy(1, 1));
        btnClearForm = new JButton();
        btnClearForm.setText("Clear");
        panel16.add(btnClearForm, cc.xy(3, 1, CellConstraints.RIGHT, CellConstraints.DEFAULT));
        btnSubmitForm = new JButton();
        btnSubmitForm.setBackground(new Color(-14260834));
        btnSubmitForm.setForeground(new Color(-1));
        btnSubmitForm.setText("Submit");
        panel16.add(btnSubmitForm, cc.xy(5, 1));
        final JPanel panel17 = new JPanel();
        panel17.setLayout(new FormLayout("left:35px:noGrow", "center:d:grow"));
        rootPanel2.add(panel17, cc.xy(3, 4));
        lblViewTemplate = new JLabel();
        lblViewTemplate.setText("");
        panel17.add(lblViewTemplate, cc.xy(1, 1));
        ButtonGroup buttonGroup;
        buttonGroup = new ButtonGroup();
        buttonGroup.add(probabilityLowRButton);
        buttonGroup.add(probabilityMediumRButton);
        buttonGroup.add(probabilityHighRButton);
        buttonGroup = new ButtonGroup();
        buttonGroup.add(impactLowRButton);
        buttonGroup.add(impactMediumRButton);
        buttonGroup.add(impactHighRButton);
        buttonGroup = new ButtonGroup();
        buttonGroup.add(noCompromisedEnvironmentRButton);
        buttonGroup.add(yesCompromisedEnvironmentRButton);
    }

    /**
     * @noinspection ALL
     */
    private Font $$$getFont$$$(String fontName, int style, int size, Font currentFont) {
        if (currentFont == null) return null;
        String resultName;
        if (fontName == null) {
            resultName = currentFont.getName();
        } else {
            Font testFont = new Font(fontName, Font.PLAIN, 10);
            if (testFont.canDisplay('a') && testFont.canDisplay('1')) {
                resultName = fontName;
            } else {
                resultName = currentFont.getName();
            }
        }
        Font font = new Font(resultName, style >= 0 ? style : currentFont.getStyle(), size >= 0 ? size : currentFont.getSize());
        boolean isMac = System.getProperty("os.name", "").toLowerCase(Locale.ENGLISH).startsWith("mac");
        Font fontWithFallback = isMac ? new Font(font.getFamily(), font.getStyle(), font.getSize()) : new StyleContext().getFont(font.getFamily(), font.getStyle(), font.getSize());
        return fontWithFallback instanceof FontUIResource ? fontWithFallback : new FontUIResource(fontWithFallback);
    }

    /**
     * @noinspection ALL
     */
    public JComponent $$$getRootComponent$$$() {
        return rootPanel;
    }


}
